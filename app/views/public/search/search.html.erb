<div class="container">
  <div class="row">
    <div class="col">
      <% if @search_type == "adv" %>
        <h3>Advanced Search</h3>
        <p>Try the <%= link_to 'Keyword search', public_search_path(:type => "kw") %></p>

        <%= form_tag(public_search_path, method: :get, id: "search_form") do %>
          <%= hidden_field_tag :type, @search_type %>

          <div class="input-group">
            <%= label_tag(:keyword, "All fields") %>
            <%= text_field_tag :keyword, params[:keyword], :class => 'form-control' %>
          </div>

          <div class="input-group">
            <%= label_tag(:title, "Title") %>
            <%= text_field_tag :title, params[:title], :class => 'form-control' %>
          </div>

          <div class="input-group">
            <%= label_tag(:journal, "Journal") %>
            <%= text_field_tag :journal, params[:journal], :class => 'form-control' %>
          </div>

          <div class="input-group">
            <%= label_tag(:location, "Publication location") %>
            <%= text_field_tag :location, params[:location], :class => 'form-control' %>
          </div>

          <div class="input-group">
            <%= label_tag(:people, "People") %>
            <%= text_field_tag :people, params[:people], :class => 'form-control' %>
          </div>

          <div class="">
            <%= submit_tag 'Search', name: nil, :class => 'btn btn-primary' %>
            <%= submit_tag("Reset", {:name => 'reset', :id => 'reset', :type => 'reset', :class => 'btn btn-default'}) %>
          </div>
        <% end %>
      <% else %>
        <h3>Keyword Search</h3>
        <p>Try the <%= link_to 'Advanced search', public_search_path(:type => "adv") %></p>

        <%= form_tag(public_search_path, method: :get, id: "search_form") do %>
          <%= hidden_field_tag :type, @search_type %>

          <div class="input-group">
            <%= label_tag(:keyword, "Keyword") %>
            <%= text_field_tag :keyword, params[:keyword], :class => 'form-control' %>
          </div>

          <div class="">
            <%= submit_tag 'Search', name: nil, :class => 'btn btn-primary' %>
            <%= submit_tag("Reset", {:name => 'reset', :id => 'reset', :type => 'reset', :class => 'btn btn-default'}) %>
          </div>
        <% end %>
      <% end %>
    </div>
  </div>
  <div class="row">
      <% if @new_search %>
        <h4>Enter a search query.</h4>
      <% elsif @texts.nil? %>
        <h4>There are no texts containing the term <strong><%= params[:keyword] %></strong>.</h4>
      <% else %>
        <div class="col-lg-4 col-md-4 col-sm-6">

          <% if @texts.aggregations.genre.buckets.present? %>
            <h3>Limit your search</h3>

            <div class="panel panel-default">
              <div class="panel-heading">Genre</div>
              <div class="panel-body">
                <ul class="facet-list-group">
                  <% @texts.aggregations.genre.buckets.each do |facet| %>
                    <% if facet["key"].present? %>
                      <li class="facet-list-group-item">
                        <div class="facet-label"><%= facet["key"] %></div>
                        <div class="facet-value"><%= facet.doc_count %></div>
                      </li>
                    <% end %>
                  <% end %>
                </ul>
              </div>
            </div>

            <div class="panel panel-default">
              <div class="panel-heading">Material type</div>
              <div class="panel-body">
                <ul class="facet-list-group">
                  <% @texts.aggregations.material_type.buckets.each do |facet| %>
                    <% if facet["key"].present? %>
                      <li class="facet-list-group-item">
                        <div class="facet-label"><%= facet["key"] %></div>
                        <div class="facet-value"><%= facet.doc_count %></div>
                      </li>
                    <% end %>
                  <% end %>
                </ul>
              </div>
            </div>

            <div class="panel panel-default">
              <div class="panel-heading">Text type</div>
              <div class="panel-body">
                <ul class="facet-list-group">
                  <% @texts.aggregations.text_type.buckets.each do |facet| %>
                    <% if facet["key"].present? %>
                      <li class="facet-list-group-item">
                        <div class="facet-label"><%= facet["key"].capitalize.gsub!('_', ' ') %></div>
                        <div class="facet-value"><%= facet.doc_count %></div>
                      </li>
                    <% end %>
                  <% end %>
                </ul>
              </div>
            </div>

            <div class="panel panel-default">
              <div class="panel-heading">Topic author</div>
              <div class="panel-body">
                <ul class="facet-list-group">
                  <% @texts.aggregations.topic_author.buckets.each do |facet| %>
                    <% if facet["key"].present? %>
                      <li class="facet-list-group-item">
                        <div class="facet-label"><%= facet["key"] %></div>
                        <div class="facet-value"><%= facet.doc_count %></div>
                      </li>
                    <% end %>
                  <% end %>
                </ul>
              </div>
            </div>

            <div class="panel panel-default">
              <div class="panel-heading">Places</div>
              <div class="panel-body">
                <ul class="facet-list-group">
                  <% @texts.aggregations.publication_places.buckets.each do |facet| %>
                    <% if facet["key"].present? %>
                      <li class="facet-list-group-item">
                        <div class="facet-label"><%= facet["key"] %></div>
                        <div class="facet-value"><%= facet.doc_count %></div>
                      </li>
                    <% end %>
                  <% end %>
                </ul>
              </div>
            </div>

            <div class="panel panel-default">
              <div class="panel-heading">Other languages</div>
              <div class="panel-body">
                <ul class="facet-list-group">
                  <% @texts.aggregations.other_text_languages.buckets.each do |facet| %>
                    <% if facet["key"].present? %>
                      <li class="facet-list-group-item">
                        <div class="facet-label"><%= facet["key"] %></div>
                        <div class="facet-value"><%= facet.doc_count %></div>
                      </li>
                    <% end %>
                  <% end %>
                </ul>
              </div>
            </div>

          <% end %>
        </div>

        <div class="col-lg-8 col-md-8 col-sm-6">
          <h3><%= page_entries_info @texts, entry_name: 'records' %> </h3>
          <%= paginate @texts %>

          <% @texts.records.each do |text| %>
            <ul class="list-group">
              <li class=" list-group-item">
                <span class="census-id"><%= text.census_id %></span>
                <%= link_to text.title, public_text_path(text.id) %>
              </li>
            </ul>
          <% end %>

          <%= paginate @texts %>
        </div>
      <% end %>
  </div>
</div>

<script>
    $("input#reset").click(function() {
        if (window.location.search.indexOf('type=adv') > -1) {
            console.log("this is an advanced search");
            window.location = window.location.pathname += "?type=adv";
        } else {
            window.location = window.location.pathname;
        }
    });
</script>