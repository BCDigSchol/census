<%= javascript_include_tag 'https://cdn.plot.ly/plotly-1.2.0.min.js' %>
<% page_title(@author.full_name) %>
<div class="container">
  <div class="row">
    <div class="back-link"><%= link_to 'â—€ Browse all authors', public_authors_path %></div>
  </div>

  <div class="row">
    <div class="col-md-6 authors-texts">
      <div class="row">
        <h1 class="col-md-12"><%= @author.full_name %></h1>
      </div>
      <h2>Texts</h2>
      <div class="row">
        <div class="pagination-stuff col-md-10">
          <%= paginate @texts %>
        </div>
      </div>
      <ul class="list-group" id="search-results">
        <% @texts.order(:sort_census_id).each do |text| %>
          <li class="list-group-item">
            <%= render 'shared/text_tombstone', text: text %>
          </li>
        <% end %>
      </ul>
    </div>
    <div class="col-md-5 col-md-offset-1">
      <% if @author.loc_name || @author.greek_authority %>
        <h2>Authority names</h2>
        <div class="auth-names">
          <% if @author.loc_name %>
            <div class="auth-name row">
              <div class="auth-name__heading col-md-12">Library of Congress</div>
              <div class="auth-name__value col-md-12"><%= @author.loc_name %></div>
            </div>
          <% end %>
          <% if @author.greek_authority %>
            <div class="auth-name row">
              <span class="auth-name__heading col-md-12">National Library of Greece</span>
              <span class="auth-name__value col-md-12"><%= @author.greek_authority %></span>
            </div>
          <% end %>
        </div>
      <% end %>
      <div class="authors-names">
        <h3>Appears in CENSUS as</h3>
        <ul class="appears-as-list">
          <% @author.names_in_source.each do |name| %>
            <li>
              <a href="/public/search?type=adv&bq=(authors_name_from_source::<%= name %>)"><%= name %></a>
            </li>
          <% end %>
        </ul>
      </div>
      <div>
        <h3 style="margin-bottom: 1em">Places of publication</h3>
        <div id="map-contents" style=""></div>
      </div>
    </div>
  </div>
</div>

<% @author.get_text_countries(@texts).each do |country| %>
  <%= country %>
<% end %>

<script>

    var data = [{
        type: 'choropleth',
        locations: [<%= country_code_list(@author) %>],
        z: <%= country_count_list(@author) %>,
        text: [<%= country_code_list(@author) %>],
        showscale: false,
        colorscale: [
            [0, 'rgb(242,240,247)'], [0.2, 'rgb(218,218,235)'],
            [0.4, 'rgb(188,189,220)'], [0.6, 'rgb(158,154,200)'],
            [0.8, 'rgb(117,107,177)'], [1, 'rgb(84,39,143)']
        ]
    }];

    var layout = {
        dragmode: false,
        title: null,
        showscale: false,
        showlegend: false,
        height: 200,
        margin: {
            l: 0,
            r: 50,
            b: 0,
            t: 0,
            pad: 4
        },
        geo: {
            scope: 'world',
            projection: {
                type: 'robinson'
            },
            showscale: false
        }
    };
    Plotly.plot('map-contents', data, layout, {showLink: false, displayModeBar: false});
</script>