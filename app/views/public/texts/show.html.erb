<% page_title("#{@text.title.gsub('_','')} by #{@text.authors_names}" ) %>
<div class="container public-show-text">
  <div class="row">
    <a class="back-link" href="javascript:history.back();">â—€ Result list</a>
  </div>
  <div class="row">
    <div>
      <h2><%= render "shared/topic_author", text: @text %></h2>
      <h3><span class="census-id"><%= @text.census_id %></span> <%= convert_underscores @text.title %></h3>
    </div>
  </div>
  <div class="row">
    <div class="original-div">
      <%= render 'original_box', text: @text %>
    </div>
    <div class="metadata-div">
      <%= render 'metadata', text: @text %>
    </div>
  </div>
</div>

<script>
    $(document).ready(function () {
        // https://stackoverflow.com/a/21903119
        function getUrlParameter(sParam) {
            var sPageURL = decodeURIComponent(window.location.search.substring(1)),
                sURLVariables = sPageURL.split('&'),
                sParameterName,
                i;

            for (i = 0; i < sURLVariables.length; i++) {
                sParameterName = sURLVariables[i].split('=');

                if (sParameterName[0] === sParam) {
                    return sParameterName[1] === undefined ? true : sParameterName[1];
                }
            }
        }

        var separate_word_search = true;
        var hl = getUrlParameter("hl");

        if (hl && hl !== 'undefined') {
            // decode HTML param
            // and convert HTML encoded spaces back into text spaces
            hl = decodeURI(hl).replace(/\+/g, ' ');

            // handle quoted search strings
            if (hl.indexOf('"') === 0) {
                separate_word_search = false;
                hl = hl.replace(/^"/, '').replace(/"$/, '');
            }

            // trigger mark.js instance with hl
            if (hl.length > 0) {
                console.log("looking to highlight: " + hl);
                $("main.container").mark(hl, {
                    "element": "mark",
                    "className": "highlight",
                    "exclude": ["dt"],
                    "separateWordSearch": separate_word_search
                });
            }
        }
    });
</script>